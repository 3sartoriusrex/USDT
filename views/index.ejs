<% include ./partials/header %>

  <section class='slider'>
    <div class="sliderContainer">
      <ul>

        <% news.slice(-3).reverse().forEach( ( news ) => { %> 
          <li class="sliderLI slideFade">
            <div class="sliderText">
              <a href='/news/<%=news._id%>'>
                <h2><%=news.title%></h2>
              </a>
              <p class="sliderDate"><%=moment(news.dateCreated).format("ddd, MMM Do YYYY")%></p>
              <p><%=news.body.substring(0,250)%>...</p>
              <a class="sliderArticleBtn btn btnDiv" href='/news/<%=news._id%>'>Read Full Text</a>
            </div>
            <a href="/news/<%=news._id%>" class ='sliderPhotoLink'>
              <img class='sliderPhoto' src="<%=news.coverImage%>" alt="science truth">
            </a>
          </li>
        <% }); %>

      </ul>
    </div>
    <div class="sliderIndicator">

      <% news.slice(-3).reverse().forEach( ( news ) => { %> 
        <div href="#" class="sliderArticleInd"><div class="square"></div></div>
      <% }); %>

    </div>
    <button class="slideleft"><i class="fas fa-arrow-left"></i></button>
    <button class="slideright"><i class="fas fa-arrow-right"></i></button>
  </section>

  <section class='announcements'>
    <div class='sectionTitleDiv'>
      <i class="fas fa-scroll"></i>
      <h2>Announcements</h2>
    </div>

    <div class="announcementsContainer">

      <% announcement.slice(-3).reverse().forEach( function (announcement){ %>

        <a class="announcediv" href="/announcements/<%=announcement.id%>">
          <p class="announceDate"><%=moment(announcement.dateLastUpdate).format("ddd, MMM Do YYYY, h:mm a")%></p>
          <p class="announceText"><%=announcement.body.substring(0,200)%>...</p>
        </a>

      <% }) %>

    </div>
    <div class="btnDiv">
      <a href="/announcements" class="readMoreBtn btn moreAnnouncements">Read More Announcements</a>
    </div>
  </section>
  
  <section class='news'>
    <div class="sectionTitleDiv">
      <i class="fas fa-newspaper"></i>
      <h2>News</h2>
    </div>
    <div class="newsContainer">

      <% news.slice(-2).reverse().forEach( function( news ) { %>

        <a href="/news/<%=news._id%>" class="newsLink newsLinkRow">
          <img src="<%=news.coverImage%>" alt="#" class="newsPhotoRow">
          <div class="newsText">
            <h4><%=news.title%></h4>
            <p class="newsDate"><%=moment(news.dateCreated).format("ddd, MMM Do YYYY")%></p>
            <p class="newsDesc"><%=news.body.substring(0,150)%>...</p>
          </div>
        </a>

      <% }) %>

    </div>
    <div class="btnDiv">
      <a href="/news" class="readMoreBtn btn moreNews">Read More News</a>
    </div>
  </section>

  <section class='report'>
    <div class="sectionTitleDiv">
      <i class="fas fa-user-secret"></i>
      <h2>Truth Crimes</h2>
    </div> 
    <p>We have entered the Post-Truth Era. Though they may be subtle, crimes which distort, twist, or confound the truth  are equivalent to lies and pose the greatest threat to Democracy today.</p>
    <p>Lies sow mistrust in institutions which rely on accurate information to serve the public. It is only through the constant pruning of lies that the rich and diverse garden of Democracy can thrive.</p>
    <p>If you witness or suspect that a crime involving the mis-use of information has occurred, is occurring, or will occurr, please file a report using the link below.</p>
    <a href="/reports/new" class="reportCrimesBtn btn">Report a Crime</a>
  </section>

  <section class="newsletterSubscribe">

    <div class="sectionTitleDiv">
      <i class="far fa-envelope"></i>
      <h2>Newsletter</h2>
    </div>
    <p>Read the USDT Newsletter and get all the Truthy Bits</p>
    <div class="subscribeGroup">
      <input class="emailSubscribeInput" type="email" id="emailSubscribe" name="emailSubscribe" placeholder="tom.i_can_handle_the_truth@cruise.com">
      <div class="subscribeToNewsletterBtn">
        <a href="#">Sign Up</a>
      </div>
    </div>

  </section>


  <script>
    // ===================================================
   // Change Layout of News Article Container depending on if the image is wider than it is tall.

  var newsLinkContainers = document.getElementsByClassName("newsLinkRow");
  var newsPhotos = document.getElementsByClassName("newsPhotoRow");

  Array.from(newsLinkContainers).forEach( ( newslinkcontainer ) => {
    Array.from(newsPhotos).forEach( ( newsphoto ) => {
      if ( newsphoto.naturalHeight < newsphoto.naturalWidth ) {
        newslinkcontainer.classList.add("newsLinkColumn");
        newslinkcontainer.classList.remove("newsLinkRow");
        newsphoto.classList.add("newsPhotoColumn");
        newsphoto.classList.remove("newsPhotoRow");
      }
    });
  });

  // =====================================================
  // Slideshow display logic;

  var sliderIndex;
  var myTimer;

  function slideShow( n ) {
    var i;
    // Grab Elements and convert Node list to Array
    var sliderListItems = Array.from(document.getElementsByClassName("sliderLI"));
    var articleIndicators = Array.from(document.getElementsByClassName("square"));

    // var sliderListArray = Array.from(sliderListItems);
    // var articleIndArray = Array.from(articleIndicators);

    // Remove visibility and active class from buttons
  for (i = 0; i < sliderListItems.length; i++) {
    sliderListItems[i].style.display = "none";
  }

  for (i = 0; i < articleIndicators.length; i++) {
    articleIndicators[i].classList.remove("active");
    articleIndicators[i].addEventListener("click", currentSlide ( i + 1 ));
  }

    // sliderListItems.forEach( (li) => {
    //   li.style.display = "none";
    // });
    // articleIndicators.forEach( (ind, index) => {
    //   ind.classList.remove("active");

      // Add currentSlide function to article Indicators (red buttons)
    //   ind.addEventListener("click",currentSlide( index+1 ));
    // });

    // Set SliderIndex based on var n passed in

    if ( n > sliderListItems.length) {
      sliderIndex = 1;
    }

    if ( n < 1 ) {
      sliderIndex = sliderListItems.length;
    }

    // Show buttons and list item based on sliderIndex

    sliderListItems[sliderIndex-1].style.display = "flex";
    articleIndicators[sliderIndex-1].classList.add("active");
  }

  // -----------------------------------------------------
  // Next / Previous Logic

  plusSlides = ( n ) => {
    clearInterval(myTimer);
    this.slideShow( sliderIndex += n );
    if ( n = -1 ) {
      myTimer = setInterval(() => {
        this.plusSlides( n + 2 );
      }, 4000);
    } else {
      myTimer = setInterval(() => {
        this.plusSlides( n + 1 );
      }, 4000);
    }
  }

  // ------------------------------------------------------
  // Begin Slideshow

  mountSlideshow = () => {
    this.slideShow( sliderIndex );
    myTimer = setInterval(() => {
      this.plusSlides(1);
    }, 4000);
  }

  // -----------------------------------------------------
  // Navigate to any slide based on red nav button

  currentSlide = ( n ) => {
    clearInterval(myTimer);
    this.slideShow( sliderIndex = n );
    if ( n = -1 ) {
      myTimer = setInterval(() => {
        this.plusSlides( n + 2 );
      }, 4000);
    } else {
      myTimer = setInterval(() => {
        this.plusSlides( n + 1 );
      }, 4000);
    }
  }

  // -------------------------------------------------
  // Navigate slide by next / previous buttons

  var leftSlide = document.getElementsByClassName("slideleft");
  var rightSlide = document.getElementsByClassName("slideright");

  leftSlide.addEventListener("click", plusSlides(-1));
  rightSlide.addEventListener("click", plusSlides(1));
  




  </script>
<% include ./partials/footer %>